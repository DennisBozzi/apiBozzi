<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/Controllers/DemoController.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Controllers/DemoController.cs" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Controllers/LabsController.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Controllers/LabsController.cs" />
              <option name="updatedContent" value="using apiBozzi.Services.FelicianoBozzi;&#10;using apiBozzi.Services.Firebase;&#10;using Microsoft.AspNetCore.Authorization;&#10;using Microsoft.AspNetCore.Mvc;&#10;&#10;namespace apiBozzi.Controllers;&#10;&#10;[Authorize]&#10;[ApiController]&#10;[Route(&quot;[controller]&quot;)]&#10;public class LabsController : ControllerBase&#10;{&#10;    private readonly DemoSeedService _seedService;&#10;    private readonly IWebHostEnvironment _env;&#10;    private readonly FirebaseUserProvider _userProvider;&#10;&#10;    public LabsController(DemoSeedService seedService, IWebHostEnvironment env, FirebaseUserProvider userProvider)&#10;    {&#10;        _seedService = seedService;&#10;        _env = env;&#10;        _userProvider = userProvider;&#10;    }&#10;&#10;    // Reinicia e popula os dados demo a partir do arquivo demo-seed.json na raiz do projeto&#10;    [HttpPost(&quot;ResetDemo&quot;)]&#10;    public async Task&lt;IActionResult&gt; ResetDemo()&#10;    {&#10;        if (!_userProvider.IsAdmin)&#10;            return Forbid();&#10;&#10;        var path = Path.Combine(_env.ContentRootPath, &quot;demo-seed.json&quot;);&#10;        try&#10;        {&#10;            var result = await _seedService.SeedFromFileAsync(path);&#10;            return Ok(result);&#10;        }&#10;        catch (FileNotFoundException)&#10;        {&#10;            return NotFound(&quot;Arquivo demo-seed.json não encontrado.&quot;);&#10;        }&#10;        catch (Exception e)&#10;        {&#10;            return StatusCode(500, $&quot;Erro ao executar seed demo: {e.Message}&quot;);&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Models/FelicianoBozzi/ApartmentDaily.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Models/FelicianoBozzi/ApartmentDaily.cs" />
              <option name="originalContent" value="using System.ComponentModel.DataAnnotations;&#10;using System.ComponentModel.DataAnnotations.Schema;&#10;using apiBozzi.Models.Enums;&#10;&#10;namespace apiBozzi.Models.FelicianoBozzi;&#10;&#10;// Tabela temporária (reset diário) usada para usuários não-admin&#10;public class ApartmentDaily&#10;{&#10;    [Key] public int Id { get; set; }&#10;    public DateTime CreatedAt { get; set; } = DateTime.Now.ToUniversalTime();&#10;    [Required] [MaxLength(10)] public string Number { get; set; } = string.Empty;&#10;&#10;    [Required]&#10;    [Column(TypeName = &quot;decimal(10,2)&quot;)]&#10;    public decimal Rent { get; set; }&#10;&#10;    [Required] public FloorEnum Floor { get; set; }&#10;    [Required] public ApartmentTypeEnum Type { get; set; }&#10;    public Tenant? Responsible { get; set; }&#10;}&#10;" />
              <option name="updatedContent" value="using System.ComponentModel.DataAnnotations;&#10;using System.ComponentModel.DataAnnotations.Schema;&#10;using apiBozzi.Models.Enums;&#10;&#10;namespace apiBozzi.Models.FelicianoBozzi;&#10;&#10;// Tabela demo (reset diário) usada para usuários não-admin&#10;public class ApartmentDemo&#10;{&#10;  [Key]&#10;  public int Id { get; set; }&#10;  public DateTime CreatedAt { get; set; } = DateTime.Now.ToUniversalTime();&#10;  [Required]&#10;  [MaxLength(10)]&#10;  public string Number { get; set; } = string.Empty;&#10;&#10;  [Required]&#10;  [Column(TypeName = &quot;decimal(10,2)&quot;)]&#10;  public decimal Rent { get; set; }&#10;&#10;  [Required]&#10;  public FloorEnum Floor { get; set; }&#10;  [Required]&#10;  public ApartmentTypeEnum Type { get; set; }&#10;  public TenantDemo? Responsible { get; set; }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Services/FirebaseService.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Services/FirebaseService.cs" />
              <option name="originalContent" value="namespace apiBozzi.Services;&#10;&#10;public class FirebaseService&#10;{&#10;    private readonly HttpClient _httpClient;&#10;}" />
              <option name="updatedContent" value="namespace apiBozzi.Services;&#10;&#10;public class FirebaseService&#10;{&#10;    private readonly HttpClient _httpClient;&#10;&#10;    public FirebaseService(HttpClient httpClient)&#10;    {&#10;        _httpClient = httpClient;&#10;    }&#10;&#10;    public async Task&lt;string&gt; LoginAsync(string email, string password, string apiKey)&#10;    {&#10;        var url = $&quot;https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key={apiKey}&quot;;&#10;        var payload = new&#10;        {&#10;            email = email,&#10;            password = password,&#10;            returnSecureToken = true&#10;        };&#10;        var content = new StringContent(System.Text.Json.JsonSerializer.Serialize(payload), System.Text.Encoding.UTF8, &quot;application/json&quot;);&#10;        var response = await _httpClient.PostAsync(url, content);&#10;        response.EnsureSuccessStatusCode();&#10;        var responseBody = await response.Content.ReadAsStringAsync();&#10;        return responseBody;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Services/Hosted/ResetDailyApartmentsHostedService.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Services/Hosted/ResetDailyApartmentsHostedService.cs" />
              <option name="originalContent" value="using apiBozzi.Context;&#10;using Microsoft.EntityFrameworkCore;&#10;&#10;namespace apiBozzi.Services.Hosted;&#10;&#10;public class ResetDailyApartmentsHostedService : IHostedService, IDisposable&#10;{&#10;    private readonly IServiceScopeFactory _scopeFactory;&#10;    private Timer? _timer;&#10;&#10;    public ResetDailyApartmentsHostedService(IServiceScopeFactory scopeFactory)&#10;    {&#10;        _scopeFactory = scopeFactory;&#10;    }&#10;&#10;    public Task StartAsync(CancellationToken cancellationToken)&#10;    {&#10;        var now = DateTime.Now;&#10;        var nextMidnight = now.Date.AddDays(1);&#10;        var initialDelay = nextMidnight - now;&#10;&#10;        _timer = new Timer(async _ =&gt; await DoWork(), null, initialDelay, TimeSpan.FromDays(1));&#10;        return Task.CompletedTask;&#10;    }&#10;&#10;    private async Task DoWork()&#10;    {&#10;        using var scope = _scopeFactory.CreateScope();&#10;        var ctx = scope.ServiceProvider.GetRequiredService&lt;AppDbContext&gt;();&#10;&#10;        await ctx.ApartmentsDemo.ExecuteDeleteAsync();&#10;    }&#10;&#10;    public Task StopAsync(CancellationToken cancellationToken)&#10;    {&#10;        _timer?.Change(Timeout.Infinite, 0);&#10;        return Task.CompletedTask;&#10;    }&#10;&#10;    public void Dispose()&#10;    {&#10;        _timer?.Dispose();&#10;    }&#10;}" />
              <option name="updatedContent" value="using apiBozzi.Context;&#10;using Microsoft.EntityFrameworkCore;&#10;&#10;namespace apiBozzi.Services.Hosted;&#10;&#10;public class ResetDailyApartmentsHostedService : IHostedService, IDisposable&#10;{&#10;    private readonly IServiceScopeFactory _scopeFactory;&#10;    private Timer? _timer;&#10;&#10;    public ResetDailyApartmentsHostedService(IServiceScopeFactory scopeFactory)&#10;    {&#10;        _scopeFactory = scopeFactory;&#10;    }&#10;&#10;    public Task StartAsync(CancellationToken cancellationToken)&#10;    {&#10;        var now = DateTime.Now;&#10;        var nextMidnight = now.Date.AddDays(1);&#10;        var initialDelay = nextMidnight - now;&#10;&#10;        _timer = new Timer(async _ =&gt; await DoWork(), null, initialDelay, TimeSpan.FromDays(1));&#10;        return Task.CompletedTask;&#10;    }&#10;&#10;    private async Task DoWork()&#10;    {&#10;        using var scope = _scopeFactory.CreateScope();&#10;        var ctx = scope.ServiceProvider.GetRequiredService&lt;AppDbContext&gt;();&#10;&#10;        // Apaga primeiro os apartamentos (possui FK p/ tenant), depois tenants&#10;        await ctx.ApartmentsDemo.ExecuteDeleteAsync();&#10;        await ctx.TenantsDemo.ExecuteDeleteAsync();&#10;    }&#10;&#10;    public Task StopAsync(CancellationToken cancellationToken)&#10;    {&#10;        _timer?.Change(Timeout.Infinite, 0);&#10;        return Task.CompletedTask;&#10;    }&#10;&#10;    public void Dispose()&#10;    {&#10;        _timer?.Dispose();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Utils/Demo/ApartmentListDemoGenerator.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Utils/Demo/ApartmentListDemoGenerator.cs" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Utils/Demo/IDemoDataGenerator.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Utils/Demo/IDemoDataGenerator.cs" />
              <option name="updatedContent" value="using System;&#10;&#10;namespace apiBozzi.Utils.Demo&#10;{&#10;    /// &lt;summary&gt;&#10;    /// Define um gerador que pode criar dados de demonstração para um tipo específico.&#10;    /// &lt;/summary&gt;&#10;    public interface IDemoDataGenerator&#10;    {&#10;        /// &lt;summary&gt;&#10;        /// Verifica se este gerador pode lidar com o tipo de objeto fornecido.&#10;        /// &lt;/summary&gt;&#10;        /// &lt;param name=&quot;type&quot;&gt;O tipo do objeto de dados.&lt;/param&gt;&#10;        /// &lt;returns&gt;True se o gerador puder lidar com o tipo; caso contrário, false.&lt;/returns&gt;&#10;        bool CanGenerate(Type type);&#10;&#10;        /// &lt;summary&gt;&#10;        /// Gera o objeto de demonstração a partir do objeto original.&#10;        /// &lt;/summary&gt;&#10;        /// &lt;param name=&quot;originalData&quot;&gt;Os dados originais da action.&lt;/param&gt;&#10;        /// &lt;returns&gt;Um objeto com dados de demonstração.&lt;/returns&gt;&#10;        object Generate(object originalData);&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/demo-seed.json">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/demo-seed.json" />
              <option name="originalContent" value="{&#10;  &quot;Tenants&quot;: [&#10;    {&#10;      &quot;FirstName&quot;: &quot;Joao&quot;,&#10;      &quot;LastName&quot;: &quot;Silva&quot;,&#10;      &quot;Cpf&quot;: &quot;11111111111&quot;,&#10;      &quot;Email&quot;: &quot;joao@example.com&quot;,&#10;      &quot;Phone&quot;: &quot;11999990001&quot;,&#10;      &quot;Born&quot;: &quot;1990-05-01T00:00:00Z&quot;&#10;    },&#10;    {&#10;      &quot;FirstName&quot;: &quot;Maria&quot;,&#10;      &quot;LastName&quot;: &quot;Silva&quot;,&#10;      &quot;Cpf&quot;: &quot;22222222222&quot;,&#10;      &quot;Email&quot;: &quot;maria@example.com&quot;,&#10;      &quot;Phone&quot;: &quot;11999990002&quot;,&#10;      &quot;ResponsibleCpf&quot;: &quot;11111111111&quot;&#10;    },&#10;    {&#10;      &quot;FirstName&quot;: &quot;Carlos&quot;,&#10;      &quot;LastName&quot;: &quot;Pereira&quot;,&#10;      &quot;Cpf&quot;: &quot;33333333333&quot;,&#10;      &quot;Email&quot;: &quot;carlos@example.com&quot;,&#10;      &quot;Phone&quot;: &quot;11999990003&quot;&#10;    }&#10;  ],&#10;  &quot;Apartments&quot;: [&#10;    { &quot;Number&quot;: &quot;101A&quot;, &quot;Rent&quot;: 1500.00, &quot;Floor&quot;: 1, &quot;Type&quot;: 0, &quot;ResponsibleCpf&quot;: &quot;11111111111&quot; },&#10;    { &quot;Number&quot;: &quot;102B&quot;, &quot;Rent&quot;: 1750.00, &quot;Floor&quot;: 1, &quot;Type&quot;: 1 },&#10;    { &quot;Number&quot;: &quot;201C&quot;, &quot;Rent&quot;: 2000.00, &quot;Floor&quot;: 2, &quot;Type&quot;: 2, &quot;ResponsibleCpf&quot;: &quot;33333333333&quot; }&#10;  ]&#10;}&#10;&#10;" />
              <option name="updatedContent" value="{&#10;  &quot;Tenants&quot;: [&#10;    { &quot;FirstName&quot;: &quot;Joao&quot;,   &quot;LastName&quot;: &quot;Silva&quot;,    &quot;Cpf&quot;: &quot;11111111111&quot;, &quot;Email&quot;: &quot;joao@example.com&quot;,   &quot;Phone&quot;: &quot;11999990001&quot;, &quot;Born&quot;: &quot;1990-05-01T00:00:00Z&quot; },&#10;    { &quot;FirstName&quot;: &quot;Maria&quot;,  &quot;LastName&quot;: &quot;Silva&quot;,    &quot;Cpf&quot;: &quot;22222222222&quot;, &quot;Email&quot;: &quot;maria@example.com&quot;,  &quot;Phone&quot;: &quot;11999990002&quot;, &quot;ResponsibleCpf&quot;: &quot;11111111111&quot; },&#10;    { &quot;FirstName&quot;: &quot;Pedro&quot;,  &quot;LastName&quot;: &quot;Silva&quot;,    &quot;Cpf&quot;: &quot;22222222223&quot;, &quot;Email&quot;: &quot;pedro@example.com&quot;,  &quot;Phone&quot;: &quot;11999990012&quot;, &quot;ResponsibleCpf&quot;: &quot;11111111111&quot; },&#10;&#10;    { &quot;FirstName&quot;: &quot;Ana&quot;,    &quot;LastName&quot;: &quot;Costa&quot;,    &quot;Cpf&quot;: &quot;44444444444&quot;, &quot;Email&quot;: &quot;ana@example.com&quot;,    &quot;Phone&quot;: &quot;11999990004&quot; },&#10;    { &quot;FirstName&quot;: &quot;Fabio&quot;,  &quot;LastName&quot;: &quot;Costa&quot;,    &quot;Cpf&quot;: &quot;44444444445&quot;, &quot;Email&quot;: &quot;fabio@example.com&quot;,  &quot;Phone&quot;: &quot;11999990005&quot;, &quot;ResponsibleCpf&quot;: &quot;44444444444&quot; },&#10;    { &quot;FirstName&quot;: &quot;Julia&quot;,  &quot;LastName&quot;: &quot;Costa&quot;,    &quot;Cpf&quot;: &quot;44444444446&quot;, &quot;Email&quot;: &quot;julia@example.com&quot;,  &quot;Phone&quot;: &quot;11999990006&quot;, &quot;ResponsibleCpf&quot;: &quot;44444444444&quot; },&#10;&#10;    { &quot;FirstName&quot;: &quot;Bruno&quot;,  &quot;LastName&quot;: &quot;Souza&quot;,    &quot;Cpf&quot;: &quot;55555555555&quot;, &quot;Email&quot;: &quot;bruno@example.com&quot;,  &quot;Phone&quot;: &quot;11999990007&quot; },&#10;    { &quot;FirstName&quot;: &quot;Luiza&quot;,  &quot;LastName&quot;: &quot;Souza&quot;,    &quot;Cpf&quot;: &quot;55555555556&quot;, &quot;Email&quot;: &quot;luiza@example.com&quot;,  &quot;Phone&quot;: &quot;11999990008&quot;, &quot;ResponsibleCpf&quot;: &quot;55555555555&quot; },&#10;    { &quot;FirstName&quot;: &quot;Rafael&quot;, &quot;LastName&quot;: &quot;Souza&quot;,    &quot;Cpf&quot;: &quot;55555555557&quot;, &quot;Email&quot;: &quot;rafael@example.com&quot;, &quot;Phone&quot;: &quot;11999990009&quot;, &quot;ResponsibleCpf&quot;: &quot;55555555555&quot; },&#10;&#10;    { &quot;FirstName&quot;: &quot;Carla&quot;,  &quot;LastName&quot;: &quot;Mendes&quot;,   &quot;Cpf&quot;: &quot;66666666666&quot;, &quot;Email&quot;: &quot;carla@example.com&quot;,  &quot;Phone&quot;: &quot;11999990010&quot; },&#10;    { &quot;FirstName&quot;: &quot;Sofia&quot;,  &quot;LastName&quot;: &quot;Mendes&quot;,   &quot;Cpf&quot;: &quot;66666666668&quot;, &quot;Email&quot;: &quot;sofia@example.com&quot;,  &quot;Phone&quot;: &quot;11999990011&quot;, &quot;ResponsibleCpf&quot;: &quot;66666666666&quot; },&#10;    { &quot;FirstName&quot;: &quot;Tiago&quot;,  &quot;LastName&quot;: &quot;Mendes&quot;,   &quot;Cpf&quot;: &quot;66666666669&quot;, &quot;Email&quot;: &quot;tiago@example.com&quot;,  &quot;Phone&quot;: &quot;11999990013&quot;, &quot;ResponsibleCpf&quot;: &quot;66666666666&quot; },&#10;&#10;    { &quot;FirstName&quot;: &quot;Diego&quot;,  &quot;LastName&quot;: &quot;Lima&quot;,     &quot;Cpf&quot;: &quot;77777777777&quot;, &quot;Email&quot;: &quot;diego@example.com&quot;,  &quot;Phone&quot;: &quot;11999990014&quot; },&#10;&#10;    { &quot;FirstName&quot;: &quot;Elisa&quot;,  &quot;LastName&quot;: &quot;Rocha&quot;,    &quot;Cpf&quot;: &quot;88888888888&quot;, &quot;Email&quot;: &quot;elisa@example.com&quot;,  &quot;Phone&quot;: &quot;11999990015&quot; },&#10;    { &quot;FirstName&quot;: &quot;Marina&quot;, &quot;LastName&quot;: &quot;Rocha&quot;,    &quot;Cpf&quot;: &quot;88888888880&quot;, &quot;Email&quot;: &quot;marina@example.com&quot;, &quot;Phone&quot;: &quot;11999990016&quot;, &quot;ResponsibleCpf&quot;: &quot;88888888888&quot; },&#10;    { &quot;FirstName&quot;: &quot;Paulo&quot;,  &quot;LastName&quot;: &quot;Rocha&quot;,    &quot;Cpf&quot;: &quot;88888888881&quot;, &quot;Email&quot;: &quot;paulo@example.com&quot;,  &quot;Phone&quot;: &quot;11999990017&quot;, &quot;ResponsibleCpf&quot;: &quot;88888888888&quot; },&#10;&#10;    { &quot;FirstName&quot;: &quot;Carlos&quot;, &quot;LastName&quot;: &quot;Pereira&quot;,  &quot;Cpf&quot;: &quot;33333333333&quot;, &quot;Email&quot;: &quot;carlos@example.com&quot;, &quot;Phone&quot;: &quot;11999990003&quot; }&#10;  ],&#10;  &quot;Apartments&quot;: [&#10;    { &quot;Number&quot;: &quot;101A&quot;, &quot;Rent&quot;: 1500.00, &quot;Floor&quot;: 1, &quot;Type&quot;: 0, &quot;ResponsibleCpf&quot;: &quot;11111111111&quot; },&#10;    { &quot;Number&quot;: &quot;102B&quot;, &quot;Rent&quot;: 1750.00, &quot;Floor&quot;: 1, &quot;Type&quot;: 1 },&#10;    { &quot;Number&quot;: &quot;103C&quot;, &quot;Rent&quot;: 1800.00, &quot;Floor&quot;: 1, &quot;Type&quot;: 2, &quot;ResponsibleCpf&quot;: &quot;44444444444&quot; },&#10;&#10;    { &quot;Number&quot;: &quot;201A&quot;, &quot;Rent&quot;: 2000.00, &quot;Floor&quot;: 2, &quot;Type&quot;: 1, &quot;ResponsibleCpf&quot;: &quot;55555555555&quot; },&#10;    { &quot;Number&quot;: &quot;202B&quot;, &quot;Rent&quot;: 1600.00, &quot;Floor&quot;: 2, &quot;Type&quot;: 0 },&#10;    { &quot;Number&quot;: &quot;203C&quot;, &quot;Rent&quot;: 2100.00, &quot;Floor&quot;: 2, &quot;Type&quot;: 2, &quot;ResponsibleCpf&quot;: &quot;66666666666&quot; },&#10;&#10;    { &quot;Number&quot;: &quot;301A&quot;, &quot;Rent&quot;: 2200.00, &quot;Floor&quot;: 3, &quot;Type&quot;: 1, &quot;ResponsibleCpf&quot;: &quot;77777777777&quot; },&#10;    { &quot;Number&quot;: &quot;302B&quot;, &quot;Rent&quot;: 1650.00, &quot;Floor&quot;: 3, &quot;Type&quot;: 0 },&#10;    { &quot;Number&quot;: &quot;303C&quot;, &quot;Rent&quot;: 2300.00, &quot;Floor&quot;: 3, &quot;Type&quot;: 2, &quot;ResponsibleCpf&quot;: &quot;88888888888&quot; },&#10;&#10;    { &quot;Number&quot;: &quot;401A&quot;, &quot;Rent&quot;: 2400.00, &quot;Floor&quot;: 4, &quot;Type&quot;: 1 },&#10;    { &quot;Number&quot;: &quot;402B&quot;, &quot;Rent&quot;: 1700.00, &quot;Floor&quot;: 4, &quot;Type&quot;: 0, &quot;ResponsibleCpf&quot;: &quot;33333333333&quot; },&#10;    { &quot;Number&quot;: &quot;403C&quot;, &quot;Rent&quot;: 2450.00, &quot;Floor&quot;: 4, &quot;Type&quot;: 2 },&#10;&#10;    { &quot;Number&quot;: &quot;S01&quot;,  &quot;Rent&quot;: 3000.00, &quot;Floor&quot;: 5, &quot;Type&quot;: 1 },&#10;    { &quot;Number&quot;: &quot;K1&quot;,   &quot;Rent&quot;: 1200.00, &quot;Floor&quot;: 6, &quot;Type&quot;: 0 }&#10;  ]&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>